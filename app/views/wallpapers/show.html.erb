<canvas width="<%= params[:width]%>"
        height="<%= params[:height]%>"
        id="the-canvas">
</canvas>

<script>
  var canvas = new fabric.Canvas('the-canvas');
  
  <% left_pos = 0 %>
  <% @palette.real_colors.each do |color| %>
    var rect = new fabric.Rect({
      left: <%= left_pos %>,
      top: 0,
      fill: '<%= color %>',
      width: <%= @each_width + 1 %>,
      height: <%= params[:height] %>
    });
  
  canvas.add(rect);
  
  <% left_pos += @each_width %>
  <% end %>

  window.location = canvas.toDataURL();
</script>